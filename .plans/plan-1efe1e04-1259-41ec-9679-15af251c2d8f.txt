ğŸŒ³ "code-review-fixes"
ğŸ“ Complete action plan for fixing all 29 issues identified in comprehensive code review of cc-view-transcript.js

Review Date: 2025-11-22
Total Issues: 29 (5 critical, 13 important, 11 suggestions)
Reference: REVIEW-FINDINGS.md
ğŸ“Š â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0% (0/34 tasks)

â”œâ”€â”€ â¸ï¸ |Phase 1: Security & Critical Integrity| "Address critical security vulnerabilities and CLAUDE.md principle violations that must be fixed before any production use." (ğŸš¨) (0%)
â”‚   â”œâ”€â”€ â¸ï¸ |Fix command injection vulnerability| "Location: cc-view-transcript.js:534\n\nUser-provided sessionId passed to shell without validation. Add input validation (regex: ^[a-zA-Z0-9_-]+$) or replace exec() with spawn() to prevent arbitrary command execution.\n\nSeverity: CRITICAL (Security)\nIssue #1 in REVIEW-FINDINGS.md" (ğŸš¨)
â”‚   â”œâ”€â”€ â¸ï¸ |Add stream resource cleanup| "Location: cc-view-transcript.js:398-418, 315-360\n\nFile streams and readline interfaces never closed on error. Implement cleanup function called on both success and error paths to prevent file descriptor leaks.\n\nSeverity: CRITICAL (Resource Management)\nIssue #4 in REVIEW-FINDINGS.md" (ğŸš¨)
â”‚   â”œâ”€â”€ â¸ï¸ |Show indicators for filtered content| "Location: cc-view-transcript.js:204-210\n\nViolates Display Integrity principle - content completely hidden when filters active. Replace filtered blocks with one-line indicators like '[THINKING BLOCK HIDDEN - remove --no-thinking to show]'.\n\nSeverity: CRITICAL (CLAUDE.md violation)\nIssue #2 in REVIEW-FINDINGS.md" (ğŸš¨)
â”‚   â”œâ”€â”€ â¸ï¸ |Show indicators for failed line parsing| "Location: cc-view-transcript.js:405-412\n\nJSON parse errors cause silent line skipping. Display one-line replacement like '[!] Line N: Failed to parse message (corrupt JSONL)' so users know data is missing.\n\nSeverity: CRITICAL (Data Loss)\nIssue #3 in REVIEW-FINDINGS.md" (ğŸš¨)
â”‚   â””â”€â”€ â¸ï¸ |Report exec() errors properly| "Location: cc-view-transcript.js:527-541\n\nfind command errors completely swallowed. Check if .claude/projects exists first, distinguish 'not found' from 'search failed', show actual errors to help users diagnose system issues.\n\nSeverity: CRITICAL (Error Handling)\nIssue #5 in REVIEW-FINDINGS.md" (ğŸš¨)
â”œâ”€â”€ â¸ï¸ |Phase 2: Display Completeness| "Fix violations of Display Completeness principle and improve data extraction to show all available information." (ğŸ”´) (0%)
â”‚   â”œâ”€â”€ â¸ï¸ |Extract ALL content blocks from tool results| "Location: cc-view-transcript.js:141-145\n\nOnly first content block extracted from array results. MCP tools return multiple blocks. Extract all blocks, handle different types, separate visually.\n\nSeverity: HIGH (CLAUDE.md violation)\nIssue #6 in REVIEW-FINDINGS.md" (ğŸ”´)
â”‚   â”œâ”€â”€ â¸ï¸ |Add JSON pretty-printing for tool results| "Location: cc-view-transcript.js:271-277\n\nStructured tool results displayed as raw text. Detect JSON and apply pretty-printing with indentation for readability.\n\nSeverity: HIGH (User Experience)\nIssue #7 in REVIEW-FINDINGS.md" (ğŸ”´)
â”‚   â””â”€â”€ â¸ï¸ |Apply truncation to all text types| "Location: cc-view-transcript.js:257-262, 272-275\n\n--truncate only affects tool I/O. Thinking blocks and text can still be 100KB+. Apply truncation consistently to all text content types.\n\nSeverity: HIGH (Scope Limitation)\nIssue #8 in REVIEW-FINDINGS.md" (ğŸ”´)
â”œâ”€â”€ â¸ï¸ |Phase 3: Error Handling & UX| "Improve error messages, input validation, and general user experience when things go wrong." (ğŸ”´) (0%)
â”‚   â”œâ”€â”€ â¸ï¸ |Add line numbers to parse errors| "Location: cc-view-transcript.js:52-59\n\nParse errors show no line number or preview. Pass line number to parseLine(), show in error message, show preview of corrupt line.\n\nSeverity: HIGH (Debugging)\nIssue #10 in REVIEW-FINDINGS.md" (ğŸ”´)
â”‚   â”œâ”€â”€ â¸ï¸ |Distinguish error types in main| "Location: cc-view-transcript.js:568-574\n\nAll errors shown as generic 'Error processing transcript'. Distinguish ENOENT, EACCES, parse errors with specific messages.\n\nSeverity: MEDIUM (User Experience)\nIssue #17 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â”œâ”€â”€ â¸ï¸ |Add parseInt validation| "Location: cc-view-transcript.js:464-467\n\nNo validation that --max-length receives valid number. Check for isNaN() and positive number, show clear error.\n\nSeverity: MEDIUM (Input Validation)\nIssue #18 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â”œâ”€â”€ â¸ï¸ |Move imports to top level| "Location: cc-view-transcript.js:533\n\nrequire('child_process') inside function. Move to top-level imports for consistency.\n\nSeverity: MEDIUM (Code Organization)\nIssue #9 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â””â”€â”€ â¸ï¸ |Fix file existence race condition| "Location: cc-view-transcript.js:554-564\n\nFile checked for existence then later opened. Just attempt to open and handle ENOENT/EACCES errors specifically.\n\nSeverity: MEDIUM (Edge Case)\nIssue #16 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”œâ”€â”€ â¸ï¸ |Phase 4: Documentation| "Fix misleading comments, add missing documentation, acknowledge known limitations." (ğŸŸ¡) (0%)
â”‚   â”œâ”€â”€ â¸ï¸ |Fix misleading filter comment| "Location: cc-view-transcript.js:328-329\n\nComment says 'Skip file-history-snapshot' but code implements inclusion filter. Rewrite to 'Only process user, assistant, and system messages'.\n\nSeverity: MEDIUM (Code Clarity)\nIssue #11 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â”œâ”€â”€ â¸ï¸ |Document incomplete extraction| "Location: cc-view-transcript.js:139-145\n\nComment doesn't mention only first block extracted. Add TODO noting Display Completeness violation, warn about MCP multi-block results.\n\nSeverity: MEDIUM (Documentation)\nIssue #12 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â”œâ”€â”€ â¸ï¸ |Document truncation scope| "Location: cc-view-transcript.js:257-262, 272-277\n\nNo comment that truncation only affects tool I/O. Add comment explaining scope limitation.\n\nSeverity: MEDIUM (Documentation)\nIssue #13 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â”œâ”€â”€ â¸ï¸ |Document filtering violations| "Location: cc-view-transcript.js:215-228\n\nNo comment that filtering violates Display Integrity. Add TODO acknowledging CLAUDE.md violation.\n\nSeverity: MEDIUM (Documentation)\nIssue #14 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â”‚   â””â”€â”€ â¸ï¸ |Add complete JSDoc| "Location: Lines 52, 64, 198, 230, 305, 362, 390, 426\n\nMost public methods missing complete JSDoc. Add @param, @returns, error case documentation for all public methods.\n\nSeverity: MEDIUM (Documentation Debt)\nIssue #15 in REVIEW-FINDINGS.md" (ğŸŸ¡)
â””â”€â”€ â¸ï¸ |Phase 5: Code Quality| "Implement simplification suggestions to improve code clarity and maintainability." (ğŸ”µ) (0%)
    â”œâ”€â”€ â¸ï¸ |Extract duplicate truncation logic| "Location: cc-view-transcript.js:257-262, 272-277\n\nNearly identical truncation code appears twice. Extract to helper method truncateIfNeeded().\n\nSeverity: LOW (Code Quality)\nIssue #19 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Extract sub-agent detection logic| "Location: Lines 113, 349\n\nSame detection logic appears twice. Create static helper MessageParser.isSubAgent().\n\nSeverity: LOW (Code Quality)\nIssue #20 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Simplify result text extraction| "Location: cc-view-transcript.js:139-145\n\nNested if/else harder to read. Extract to helper extractResultText().\n\nSeverity: LOW (Code Quality)\nIssue #21 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Simplify error detection| "Location: cc-view-transcript.js:135-137\n\nThree-way OR check verbose. Simplify to: const isError = !!(message.toolUseResult?.is_error || block.is_error);\n\nSeverity: LOW (Code Quality)\nIssue #22 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Use consistent separator widths| "Location: Lines 192, 366\n\nMagic numbers for separator widths inconsistent. Define DISPLAY constants at top.\n\nSeverity: LOW (Code Quality)\nIssue #23 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Simplify getBlockLabel() switch| "Location: cc-view-transcript.js:284-297\n\nLong switch for simple mappings. Use object lookup for simple cases.\n\nSeverity: LOW (Code Quality)\nIssue #24 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Remove redundant null check| "Location: cc-view-transcript.js:67\n\nCheck if (!message) before switch is redundant. Remove, let switch handle naturally.\n\nSeverity: LOW (Code Quality)\nIssue #25 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Improve variable naming| "Location: cc-view-transcript.js:322\n\nfirstMessage boolean flag name confusing. Rename to metadataExtracted or needsMetadata.\n\nSeverity: LOW (Code Clarity)\nIssue #26 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Modernize Promise pattern| "Location: cc-view-transcript.js:532-540\n\nManual Promise wrapper around exec() is old-style. Use util.promisify() for cleaner code.\n\nSeverity: LOW (Code Quality)\nIssue #27 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â”œâ”€â”€ â¸ï¸ |Simplify switch fallthrough| "Location: cc-view-transcript.js:241-247\n\nMultiple cases falling through harder to read. Define textTypes array and use includes().\n\nSeverity: LOW (Code Clarity)\nIssue #28 in REVIEW-FINDINGS.md" (ğŸ”µ)
    â””â”€â”€ â¸ï¸ |Remove redundant comment| "Location: cc-view-transcript.js:69\n\nComment 'Handle different message types' before switch is self-evident. Remove.\n\nSeverity: LOW (Code Clarity)\nIssue #29 in REVIEW-FINDINGS.md" (ğŸ”µ)
